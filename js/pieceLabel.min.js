!function(){function t(){this.drawDataset=this.drawDataset.bind(this)}"undefined"!=typeof Chart?(t.prototype.beforeDatasetsUpdate=function(t){if(this.parseOptions(t)&&"outside"===this.position){var e=1.5*this.fontSize+2;t.chartArea.top+=e,t.chartArea.bottom-=e}},t.prototype.afterDatasetsDraw=function(t){this.parseOptions(t)&&(this.labelBounds=[],t.config.data.datasets.forEach(this.drawDataset))},t.prototype.drawDataset=function(t){for(var e=this.ctx,i=this.chartInstance,o=t._meta[Object.keys(t._meta)[0]],a=0,s=0;s<o.data.length;s++){var r,n=o.data[s],h=n._view;if(0!==h.circumference||this.showZero){switch(this.render){case"value":var l=t.data[s];this.format&&(l=this.format(l)),r=l.toString();break;case"label":r=i.config.data.labels[s];break;case"image":r=this.images[s]?this.loadImage(this.images[s]):"";break;case"percentage":default:var f=h.circumference/this.options.circumference*100;f=parseFloat(f.toFixed(this.precision)),this.showActualPercentages||(a+=f)>100&&(f-=a-100,f=parseFloat(f.toFixed(this.precision))),r=f+"%"}if("function"==typeof this.render&&"object"==typeof(r=this.render({label:i.config.data.labels[s],value:t.data[s],percentage:f,dataset:t,index:s}))&&(r=this.loadImage(r)),!r)return;var c,p,d;if(e.save(),e.beginPath(),e.font=Chart.helpers.fontString(this.fontSize,this.fontStyle,this.fontFamily),"outside"===this.position||"border"===this.position&&"pie"===i.config.type){p=h.outerRadius/2;var u,g=this.fontSize+2,x=h.startAngle+(h.endAngle-h.startAngle)/2;"border"===this.position?u=(h.outerRadius-p)/2+p:"outside"===this.position&&(u=h.outerRadius-p+p+g),c={x:h.x+Math.cos(x)*u,y:h.y+Math.sin(x)*u},"outside"===this.position&&(c.x<h.x?c.x-=g:c.x+=g,d=h.outerRadius+g)}else p=h.innerRadius,c=n.tooltipPosition();var y=this.fontColor;if("function"==typeof y?y=y({label:i.config.data.labels[s],value:t.data[s],percentage:f,text:r,backgroundColor:t.backgroundColor[s],dataset:t,index:s}):"string"!=typeof y&&(y=y[s]||this.options.defaultFontColor),this.arc)d||(d=(p+h.outerRadius)/2),e.fillStyle=y,e.textBaseline="middle",this.drawArcText(r,d,h,this.overlap);else{var b=this.measureText(r),m=c.x-b.width/2,v=c.x+b.width/2,w=c.y-this.fontSize/2,S=c.y+this.fontSize/2;(!!this.overlap||("outside"===this.position?this.checkTextBound(m,v,w,S):n.inRange(m,w)&&n.inRange(m,S)&&n.inRange(v,w)&&n.inRange(v,S)))&&this.fillText(r,c,y)}e.restore()}}},t.prototype.parseOptions=function(t){var e=t.options.pieceLabel;return!!e&&(this.chartInstance=t,this.ctx=t.chart.ctx,this.options=t.config.options,this.render=e.render||e.mode,this.position=e.position||"default",this.arc=e.arc,this.format=e.format,this.precision=e.precision||0,this.fontSize=e.fontSize||this.options.defaultFontSize,this.fontColor=e.fontColor||this.options.defaultFontColor,this.fontStyle=e.fontStyle||this.options.defaultFontStyle,this.fontFamily=e.fontFamily||this.options.defaultFontFamily,this.hasTooltip=t.tooltip._active&&t.tooltip._active.length,this.showZero=e.showZero,this.overlap=e.overlap,this.images=e.images||[],this.showActualPercentages=e.showActualPercentages||!1,!0)},t.prototype.checkTextBound=function(t,e,i,o){for(var a=this.labelBounds,s=0;s<a.length;++s){for(var r=a[s],n=[[t,i],[t,o],[e,i],[e,o]],h=0;h<n.length;++h){var l=n[h][0],f=n[h][1];if(l>=r.left&&l<=r.right&&f>=r.top&&f<=r.bottom)return!1}n=[[r.left,r.top],[r.left,r.bottom],[r.right,r.top],[r.right,r.bottom]];for(h=0;h<n.length;++h){l=n[h][0],f=n[h][1];if(l>=t&&l<=e&&f>=i&&f<=o)return!1}}return a.push({left:t,right:e,top:i,bottom:o}),!0},t.prototype.measureText=function(t){return"object"==typeof t?{width:t.width,height:t.height}:this.ctx.measureText(t)},t.prototype.fillText=function(t,e,i){var o=this.ctx;"object"==typeof t?o.drawImage(t,e.x-t.width/2,e.y-t.height/2,t.width,t.height):(o.fillStyle=i,o.textBaseline="top",o.textAlign="center",o.fillText(t,e.x,e.y-this.fontSize/2))},t.prototype.loadImage=function(t){var e=new Image;return e.src=t.src,e.width=t.width,e.height=t.height,e},t.prototype.drawArcText=function(t,e,i,o){var a=this.ctx,s=i.x,r=i.y,n=i.startAngle,h=i.endAngle;a.save(),a.translate(s,r);var l=h-n;n+=Math.PI/2,h+=Math.PI/2;var f=n,c=this.measureText(t);if(n+=(h-(c.width/e+n))/2,!o&&h-n>l)a.restore();else{if("string"==typeof t){a.rotate(n);for(var p=0;p<t.length;p++){var d=t.charAt(p);c=a.measureText(d),a.save(),a.translate(0,-1*e),a.fillText(d,0,0),a.restore(),a.rotate(c.width/e)}}else a.rotate((f+h)/2),a.translate(0,-1*e),this.fillText(t,{x:0,y:0});a.restore()}},Chart.pluginService.register({beforeInit:function(e){e.pieceLabel=new t},beforeDatasetsUpdate:function(t){t.pieceLabel.beforeDatasetsUpdate(t)},afterDatasetsDraw:function(t){t.pieceLabel.afterDatasetsDraw(t)}})):console.warn("Can not find Chart object.")}();
